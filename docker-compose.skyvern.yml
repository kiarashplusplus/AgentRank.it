# Skyvern Setup for Deep Mode
# Self-hosted Skyvern container for Vision-LLM based audits

services:
  skyvern:
    image: skyvern/skyvern:latest
    container_name: agentrank-skyvern
    ports:
      - "8000:8000"
      - "8080:8080"  # UI
    environment:
      # LLM Configuration (choose one)
      - LLM_KEY=${OPENAI_API_KEY}
      - LLM_PROVIDER=openai
      - LLM_MODEL=gpt-4o
      
      # Alternative: Use Anthropic Claude
      # - LLM_KEY=${ANTHROPIC_API_KEY}
      # - LLM_PROVIDER=anthropic
      # - LLM_MODEL=claude-sonnet-4-20250514
      
      # Skyvern settings
      - SKYVERN_API_KEY=${SKYVERN_API_KEY:-agentrank-local-key}
      - MAX_CONCURRENT_TASKS=3
      - TASK_TIMEOUT=120
      
      # Browser settings
      - BROWSER_HEADLESS=true
      - BROWSER_VIEWPORT_WIDTH=1280
      - BROWSER_VIEWPORT_HEIGHT=720
      
    volumes:
      - skyvern-data:/data
      - skyvern-screenshots:/app/screenshots
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # PostgreSQL for Skyvern task persistence
  postgres:
    image: postgres:15-alpine
    container_name: agentrank-postgres
    environment:
      - POSTGRES_USER=skyvern
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-skyvern-local}
      - POSTGRES_DB=skyvern
    volumes:
      - postgres-data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  skyvern-data:
  skyvern-screenshots:
  postgres-data:
